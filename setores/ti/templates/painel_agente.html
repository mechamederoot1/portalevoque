<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Painel do Agente - Evoque Fitness</title>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <link rel="stylesheet" href="{{ url_for('static', filename='ti/css/painel/painel.css') }}">
</head>
<body data-theme="dark">

  <!-- Botão para alternar sidebar em mobile -->
  <button class="sidebar-toggle" id="sidebarToggle" aria-label="Alternar menu">
    <i class="fas fa-bars"></i>
  </button>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar" aria-label="Menu lateral do agente">
    <div class="logo" tabindex="0" aria-label="Logo Evoque Fitness">
      <img src="https://images.totalpass.com/public/1280x720/czM6Ly90cC1pbWFnZS1hZG1pbi1wcm9kL2d5bXMvNHVrOWtkOGd3M2xlMXg4OGNzdzViN2NhdmUzY2hhNWV3Y2lyd2pyNmI4djl6aXdiNTV2YXg3bjJ2aDI2" alt="Evoque Fitness Logo" />
    </div>
    <nav>
      <ul>
        <li><a href="#dashboard-agente" class="active" tabindex="0" aria-current="page"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a></li>

        <li class="has-submenu" tabindex="0" aria-haspopup="true" aria-expanded="false">
          <a href="#" class="submenu-toggle" aria-controls="submenu-gerenciar-chamados-agente" aria-expanded="false" tabindex="0">
            <i class="fas fa-ticket-alt"></i><span>Gerenciar Chamados</span>
          </a>
          <ul class="submenu" id="submenu-gerenciar-chamados-agente" aria-label="submenu gerenciar chamados" role="menu">
            <li role="none">
              <a href="#chamados-disponiveis" role="menuitem" tabindex="-1">
                <i class="fas fa-inbox"></i><span>Disponíveis</span>
              </a>
            </li>
            <li role="none">
              <a href="#meus-chamados-ativos" role="menuitem" tabindex="-1">
                <i class="fas fa-tasks"></i><span>Meus Ativos</span>
              </a>
            </li>
            <li role="none">
              <a href="#meus-chamados-aguardando" role="menuitem" tabindex="-1">
                <i class="fas fa-pause"></i><span>Aguardando</span>
              </a>
            </li>
            <li role="none">
              <a href="#meus-chamados-concluidos" role="menuitem" tabindex="-1">
                <i class="fas fa-check-circle"></i><span>Concluídos</span>
              </a>
            </li>
            <li role="none">
              <a href="#meus-chamados-cancelados" role="menuitem" tabindex="-1">
                <i class="fas fa-times-circle"></i><span>Cancelados</span>
              </a>
            </li>
          </ul>
        </li>

        <li><a href="#historico-agente" tabindex="0"><i class="fas fa-history"></i><span>Meu Histórico</span></a></li>
        <li><a href="#estatisticas-agente" tabindex="0"><i class="fas fa-chart-bar"></i><span>Minhas Estatísticas</span></a></li>
        <li><a href="#perfil-agente" tabindex="0"><i class="fas fa-user-cog"></i><span>Meu Perfil</span></a></li>

        {% if current_user.nivel_acesso == 'Administrador' %}
        <li><hr class="sidebar-divider"></li>
        <li><a href="{{ url_for('ti.painel') }}" tabindex="0"><i class="fas fa-tools"></i><span>Painel Admin</span></a></li>
        {% endif %}
      </ul>
    </nav>
  </aside>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark navbar-panel">
    <div class="container-fluid">
      <div class="d-flex align-items-center">
        <button class="btn btn-link text-white me-3 d-lg-none" id="mobileSidebarToggle" aria-label="Alternar menu lateral">
          <i class="fas fa-bars"></i>
        </button>
        <span class="navbar-brand mb-0 h1 d-none d-lg-block">Painel do Agente de Suporte</span>
      </div>

      <div class="collapse navbar-collapse" id="navbarPanel">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link-panel" href="#" id="btnNotificacoes">
              <i class="fas fa-bell me-1"></i>
              Notificações
              <span class="notification-badge" id="notificationCount" style="display: none;">0</span>
            </a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link-panel dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="fas fa-user-circle me-1"></i>
              {% if current_user.is_authenticated %}
                {{ current_user.nome }} {{ current_user.sobrenome }} (Agente)
              {% else %}
                Agente
              {% endif %}
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
              <li><a class="dropdown-item" href="#perfil-agente"><i class="fas fa-user me-2"></i> Meu Perfil</a></li>
              <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i> Preferências</a></li>
              {% if current_user.nivel_acesso == 'Administrador' %}
              <li><hr class="dropdown-divider" /></li>
              <li><a class="dropdown-item" href="{{ url_for('ti.painel') }}"><i class="fas fa-tools me-2"></i> Painel Admin</a></li>
              {% endif %}
              <li><hr class="dropdown-divider" /></li>
              <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}"><i class="fas fa-sign-out-alt me-2"></i> Sair</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="main-content" id="mainContent" tabindex="0">
    
    <!-- Dashboard do Agente -->
    <div class="section-content" id="dashboard-agente">
      <div class="container-fluid py-4">
        
        <!-- Cabeçalho com Estatísticas -->
        <div class="row mb-4">
          <div class="col-12">
            <h2 class="mb-3">
              <i class="fas fa-tachometer-alt me-2"></i>Meu Dashboard
            </h2>
          </div>
        </div>

        <!-- Cards de Estatísticas -->
        <div class="row mb-4">
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-warning text-white">
              <div class="card-body">
                <div class="d-flex justify-content-between">
                  <div>
                    <h6 class="card-title">Chamados Atribuídos</h6>
                    <h3 id="chamadosAtribuidos">0</h3>
                    <small>Ativos para mim</small>
                  </div>
                  <div class="align-self-center">
                    <i class="fas fa-tasks fa-2x"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-success text-white">
              <div class="card-body">
                <div class="d-flex justify-content-between">
                  <div>
                    <h6 class="card-title">Concluídos Hoje</h6>
                    <h3 id="concluidosHoje">0</h3>
                    <small>Resolvidos</small>
                  </div>
                  <div class="align-self-center">
                    <i class="fas fa-check-circle fa-2x"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-info text-white">
              <div class="card-body">
                <div class="d-flex justify-content-between">
                  <div>
                    <h6 class="card-title">Chamados Disponíveis</h6>
                    <h3 id="chamadosDisponiveis">0</h3>
                    <small>Sem agente</small>
                  </div>
                  <div class="align-self-center">
                    <i class="fas fa-folder-open fa-2x"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-primary text-white">
              <div class="card-body">
                <div class="d-flex justify-content-between">
                  <div>
                    <h6 class="card-title">Tempo Médio</h6>
                    <h3 id="tempoMedio">0h</h3>
                    <small>De resolução</small>
                  </div>
                  <div class="align-self-center">
                    <i class="fas fa-clock fa-2x"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Chamados Disponíveis para Atribuição -->
        <div class="row mb-4">
          <div class="col-12">
            <div class="card">
              <div class="card-header">
                <h5 class="card-title mb-0">
                  <i class="fas fa-inbox me-2"></i>Chamados Disponíveis
                  <span class="badge bg-secondary ms-2" id="countDisponiveis">0</span>
                </h5>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-dark table-striped table-hover">
                    <thead>
                      <tr>
                        <th>Código</th>
                        <th>Solicitante</th>
                        <th>Problema</th>
                        <th>Prioridade</th>
                        <th>Data Abertura</th>
                        <th>Ações</th>
                      </tr>
                    </thead>
                    <tbody id="tabelaChamadosDisponiveis">
                      <!-- Dados serão carregados dinamicamente -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Meus Chamados -->
        <div class="row mb-4">
          <div class="col-12">
            <div class="card">
              <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                  <h5 class="card-title mb-0">
                    <i class="fas fa-user-cog me-2"></i>Meus Chamados
                    <span class="badge bg-warning ms-2" id="countMeusChamados">0</span>
                  </h5>
                  <div class="btn-group" role="group">
                    <button type="button" class="btn btn-sm btn-outline-light active" data-filter="ativos">
                      <i class="fas fa-play me-1"></i>Ativos
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-light" data-filter="aguardando">
                      <i class="fas fa-pause me-1"></i>Aguardando
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-light" data-filter="concluidos">
                      <i class="fas fa-check me-1"></i>Concluídos
                    </button>
                  </div>
                </div>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-dark table-striped table-hover">
                    <thead>
                      <tr>
                        <th>Código</th>
                        <th>Solicitante</th>
                        <th>Problema</th>
                        <th>Status</th>
                        <th>Prioridade</th>
                        <th>Atribuído em</th>
                        <th>Ações</th>
                      </tr>
                    </thead>
                    <tbody id="tabelaMeusChamados">
                      <!-- Dados serão carregados dinamicamente -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Seção: Chamados Disponíveis -->
    <div class="section-content" id="chamados-disponiveis" style="display: none;">
      <div class="container-fluid py-4">
        <div class="row mb-4">
          <div class="col-12">
            <h2 class="mb-3">
              <i class="fas fa-inbox me-2"></i>Chamados Disponíveis
            </h2>
          </div>
        </div>
        
        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-header">
                <h5 class="card-title mb-0">
                  <i class="fas fa-inbox me-2"></i>Chamados Aguardando Atribuição
                  <span class="badge bg-info ms-2" id="countDisponiveisPage">0</span>
                </h5>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-dark table-striped table-hover">
                    <thead>
                      <tr>
                        <th>Código</th>
                        <th>Protocolo</th>
                        <th>Solicitante</th>
                        <th>Problema</th>
                        <th>Prioridade</th>
                        <th>Data Abertura</th>
                        <th>Descrição</th>
                        <th>Ações</th>
                      </tr>
                    </thead>
                    <tbody id="tabelaChamadosDisponiveisPage">
                      <tr><td colspan="8" class="text-center">Carregando...</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Seção: Meus Chamados Ativos -->
    <div class="section-content" id="meus-chamados-ativos" style="display: none;">
      <div class="container-fluid py-4">
        <div class="row mb-4">
          <div class="col-12">
            <h2 class="mb-3">
              <i class="fas fa-tasks me-2"></i>Meus Chamados Ativos
            </h2>
          </div>
        </div>
        
        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-header">
                <h5 class="card-title mb-0">
                  <i class="fas fa-user-cog me-2"></i>Chamados em Atendimento
                  <span class="badge bg-warning ms-2" id="countAtivosPage">0</span>
                </h5>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-dark table-striped table-hover">
                    <thead>
                      <tr>
                        <th>Código</th>
                        <th>Protocolo</th>
                        <th>Solicitante</th>
                        <th>Problema</th>
                        <th>Status</th>
                        <th>Prioridade</th>
                        <th>Atribuído em</th>
                        <th>Ações</th>
                      </tr>
                    </thead>
                    <tbody id="tabelaMeusChamadosAtivosPage">
                      <tr><td colspan="8" class="text-center">Carregando...</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Seção: Aguardando Resposta -->
    <div class="section-content" id="meus-chamados-aguardando" style="display: none;">
      <div class="container-fluid py-4">
        <div class="row mb-4">
          <div class="col-12">
            <h2 class="mb-3">
              <i class="fas fa-pause me-2"></i>Chamados Aguardando Resposta
            </h2>
          </div>
        </div>
        
        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-header">
                <h5 class="card-title mb-0">
                  <i class="fas fa-clock me-2"></i>Aguardando Retorno do Cliente
                  <span class="badge bg-secondary ms-2" id="countAguardandoPage">0</span>
                </h5>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-dark table-striped table-hover">
                    <thead>
                      <tr>
                        <th>Código</th>
                        <th>Protocolo</th>
                        <th>Solicitante</th>
                        <th>Problema</th>
                        <th>Status</th>
                        <th>Prioridade</th>
                        <th>Atribuído em</th>
                        <th>Ações</th>
                      </tr>
                    </thead>
                    <tbody id="tabelaMeusChamadosAguardandoPage">
                      <tr><td colspan="8" class="text-center">Carregando...</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Seção: Chamados Concluídos -->
    <div class="section-content" id="meus-chamados-concluidos" style="display: none;">
      <div class="container-fluid py-4">
        <div class="row mb-4">
          <div class="col-12">
            <h2 class="mb-3">
              <i class="fas fa-check-circle me-2"></i>Chamados Concluídos
            </h2>
          </div>
        </div>
        
        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-header">
                <h5 class="card-title mb-0">
                  <i class="fas fa-check-double me-2"></i>Meus Chamados Finalizados
                  <span class="badge bg-success ms-2" id="countConcluidosPage">0</span>
                </h5>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-dark table-striped table-hover">
                    <thead>
                      <tr>
                        <th>Código</th>
                        <th>Protocolo</th>
                        <th>Solicitante</th>
                        <th>Problema</th>
                        <th>Status</th>
                        <th>Prioridade</th>
                        <th>Concluído em</th>
                        <th>Ações</th>
                      </tr>
                    </thead>
                    <tbody id="tabelaMeusChamadosConcluidosPage">
                      <tr><td colspan="8" class="text-center">Carregando...</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Seção: Chamados Cancelados -->
    <div class="section-content" id="meus-chamados-cancelados" style="display: none;">
      <div class="container-fluid py-4">
        <div class="row mb-4">
          <div class="col-12">
            <h2 class="mb-3">
              <i class="fas fa-times-circle me-2"></i>Chamados Cancelados
            </h2>
          </div>
        </div>

        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-header">
                <h5 class="card-title mb-0">
                  <i class="fas fa-ban me-2"></i>Meus Chamados Cancelados
                  <span class="badge bg-danger ms-2" id="countCanceladosPage">0</span>
                </h5>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-dark table-striped table-hover">
                    <thead>
                      <tr>
                        <th>Código</th>
                        <th>Protocolo</th>
                        <th>Solicitante</th>
                        <th>Problema</th>
                        <th>Status</th>
                        <th>Prioridade</th>
                        <th>Cancelado em</th>
                        <th>Ações</th>
                      </tr>
                    </thead>
                    <tbody id="tabelaMeusChamadosCanceladosPage">
                      <tr><td colspan="8" class="text-center">Carregando...</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Seção: Histórico -->
    <div class="section-content" id="historico-agente" style="display: none;">
      <div class="container-fluid py-4">
        <div class="row mb-4">
          <div class="col-12">
            <h2 class="mb-3">
              <i class="fas fa-history me-2"></i>Meu Histórico
            </h2>
          </div>
        </div>
        
        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-header">
                <h5 class="card-title mb-0">
                  <i class="fas fa-list me-2"></i>Histórico de Atendimentos
                </h5>
              </div>
              <div class="card-body">
                <div class="row mb-3">
                  <div class="col-md-4">
                    <label for="filtroDataInicio" class="form-label">Data Início</label>
                    <input type="date" class="form-control" id="filtroDataInicio">
                  </div>
                  <div class="col-md-4">
                    <label for="filtroDataFim" class="form-label">Data Fim</label>
                    <input type="date" class="form-control" id="filtroDataFim">
                  </div>
                  <div class="col-md-4">
                    <label for="filtroStatus" class="form-label">Status</label>
                    <select class="form-control" id="filtroStatus">
                      <option value="">Todos</option>
                      <option value="Concluido">Concluído</option>
                      <option value="Cancelado">Cancelado</option>
                    </select>
                  </div>
                </div>
                <div class="row mb-3">
                  <div class="col-12">
                    <button class="btn btn-primary" onclick="painelAgente.filtrarHistorico()">
                      <i class="fas fa-search"></i> Buscar
                    </button>
                  </div>
                </div>
                <div class="table-responsive">
                  <table class="table table-dark table-striped table-hover">
                    <thead>
                      <tr>
                        <th>Código</th>
                        <th>Solicitante</th>
                        <th>Problema</th>
                        <th>Status</th>
                        <th>Data Atribuição</th>
                        <th>Data Conclusão</th>
                        <th>Ações</th>
                      </tr>
                    </thead>
                    <tbody id="tabelaHistoricoAgente">
                      <tr><td colspan="7" class="text-center">Use os filtros para buscar o histórico</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Seção: Estatísticas -->
    <div class="section-content" id="estatisticas-agente" style="display: none;">
      <div class="container-fluid py-4">
        <div class="row mb-4">
          <div class="col-12">
            <h2 class="mb-3">
              <i class="fas fa-chart-bar me-2"></i>Minhas Estatísticas
            </h2>
          </div>
        </div>
        
        <div class="row mb-4">
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-primary text-white">
              <div class="card-body">
                <div class="d-flex justify-content-between">
                  <div>
                    <h6 class="card-title">Total Atendidos</h6>
                    <h3 id="estatTotalAtendidos">0</h3>
                    <small>Este mês</small>
                  </div>
                  <div class="align-self-center">
                    <i class="fas fa-check-circle fa-2x"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-success text-white">
              <div class="card-body">
                <div class="d-flex justify-content-between">
                  <div>
                    <h6 class="card-title">Tempo Médio</h6>
                    <h3 id="estatTempoMedio">0h</h3>
                    <small>De resolução</small>
                  </div>
                  <div class="align-self-center">
                    <i class="fas fa-clock fa-2x"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-info text-white">
              <div class="card-body">
                <div class="d-flex justify-content-between">
                  <div>
                    <h6 class="card-title">Atendimentos Hoje</h6>
                    <h3 id="estatAtendimentosHoje">0</h3>
                    <small>Concluídos</small>
                  </div>
                  <div class="align-self-center">
                    <i class="fas fa-calendar-day fa-2x"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-warning text-white">
              <div class="card-body">
                <div class="d-flex justify-content-between">
                  <div>
                    <h6 class="card-title">Avaliação Média</h6>
                    <h3 id="estatAvaliacaoMedia">5.0</h3>
                    <small>De 5 estrelas</small>
                  </div>
                  <div class="align-self-center">
                    <i class="fas fa-star fa-2x"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="row">
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <h5 class="card-title mb-0">Chamados por Status (30 dias)</h5>
              </div>
              <div class="card-body">
                <canvas id="graficoStatusChamados" width="400" height="200"></canvas>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <h5 class="card-title mb-0">Performance Mensal</h5>
              </div>
              <div class="card-body">
                <canvas id="graficoPerformanceMensal" width="400" height="200"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Seção: Meu Perfil -->
    <div class="section-content" id="perfil-agente" style="display: none;">
      <div class="container-fluid py-4">
        <div class="row mb-4">
          <div class="col-12">
            <h2 class="mb-3">
              <i class="fas fa-user-cog me-2"></i>Meu Perfil
            </h2>
          </div>
        </div>
        
        <div class="row">
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <h5 class="card-title mb-0">Informações Pessoais</h5>
              </div>
              <div class="card-body">
                <form id="formPerfilAgente">
                  <div class="mb-3">
                    <label for="perfilNome" class="form-label">Nome Completo</label>
                    <input type="text" class="form-control" id="perfilNome" readonly>
                  </div>
                  <div class="mb-3">
                    <label for="perfilEmail" class="form-label">E-mail</label>
                    <input type="email" class="form-control" id="perfilEmail" readonly>
                  </div>
                  <div class="mb-3">
                    <label for="perfilTelefone" class="form-label">Telefone</label>
                    <input type="text" class="form-control" id="perfilTelefone">
                  </div>
                  <div class="mb-3">
                    <label for="perfilEspecialidades" class="form-label">Especialidades</label>
                    <textarea class="form-control" id="perfilEspecialidades" rows="3" placeholder="Hardware, Software, Redes..."></textarea>
                  </div>
                  <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Salvar Alterações
                  </button>
                </form>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <h5 class="card-title mb-0">Configurações de Trabalho</h5>
              </div>
              <div class="card-body">
                <div class="mb-3">
                  <label for="perfilNivelExperiencia" class="form-label">Nível de Experiência</label>
                  <select class="form-control" id="perfilNivelExperiencia">
                    <option value="junior">Junior</option>
                    <option value="pleno">Pleno</option>
                    <option value="senior">Senior</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label for="perfilMaxChamados" class="form-label">Máximo de Chamados Simultâneos</label>
                  <input type="number" class="form-control" id="perfilMaxChamados" min="1" max="50">
                </div>
                <div class="mb-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="perfilNotificacoes">
                    <label class="form-check-label" for="perfilNotificacoes">
                      Receber notificações de novos chamados
                    </label>
                  </div>
                </div>
                <div class="mb-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="perfilAutoAtribuicao">
                    <label class="form-check-label" for="perfilAutoAtribuicao">
                      Permitir auto-atribuição de chamados
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </main>

  <!-- Container de Notificações -->
  <div id="notificationContainer" class="notification-container"></div>

  <!-- Modal Detalhes do Chamado -->
  <div class="modal fade" id="modalChamado" tabindex="-1" aria-labelledby="modalTitle" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content bg-dark">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTitle">Detalhes do Chamado</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label"><strong>C��digo:</strong></label>
                <div class="form-control-plaintext text-white" id="modalCodigo">-</div>
              </div>
              <div class="mb-3">
                <label class="form-label"><strong>Protocolo:</strong></label>
                <div class="form-control-plaintext text-white" id="modalProtocolo">-</div>
              </div>
              <div class="mb-3">
                <label class="form-label"><strong>Solicitante:</strong></label>
                <div class="form-control-plaintext text-white" id="modalSolicitante">-</div>
              </div>
              <div class="mb-3">
                <label class="form-label"><strong>E-mail:</strong></label>
                <div class="form-control-plaintext text-white" id="modalEmail">-</div>
              </div>
              <div class="mb-3">
                <label class="form-label"><strong>Telefone:</strong></label>
                <div class="form-control-plaintext text-white" id="modalTelefone">-</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label"><strong>Unidade:</strong></label>
                <div class="form-control-plaintext text-white" id="modalUnidade">-</div>
              </div>
              <div class="mb-3">
                <label class="form-label"><strong>Problema:</strong></label>
                <div class="form-control-plaintext text-white" id="modalProblema">-</div>
              </div>
              <div class="mb-3">
                <label class="form-label"><strong>Prioridade:</strong></label>
                <span class="badge" id="modalPrioridade">-</span>
              </div>
              <div class="mb-3">
                <label class="form-label"><strong>Data de Abertura:</strong></label>
                <div class="form-control-plaintext text-white" id="modalDataAbertura">-</div>
              </div>
              <div class="mb-3" id="modalAgenteInfo" style="display: none;">
                <label class="form-label"><strong>Agente Atribuído:</strong></label>
                <div class="form-control-plaintext text-white" id="modalAgente">-</div>
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-12">
              <div class="mb-3">
                <label class="form-label"><strong>Descrição:</strong></label>
                <div class="form-control-plaintext text-white border p-3 rounded" id="modalDescricao" style="background-color: #2c3e50; min-height: 80px;">-</div>
              </div>
            </div>
          </div>
          
          <div class="row" id="modalActionsSection">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="modalStatus" class="form-label"><strong>Alterar Status:</strong></label>
                <select class="form-control" id="modalStatus">
                  <option value="Aberto">Aberto</option>
                  <option value="Aguardando">Aguardando</option>
                  <option value="Concluido">Concluído</option>
                  <option value="Cancelado">Cancelado</option>
                </select>
              </div>
            </div>
            <div class="col-md-6" id="modalTransferSection" style="display: none;">
              <div class="mb-3">
                <label for="modalTransferirPara" class="form-label"><strong>Transferir para:</strong></label>
                <select class="form-control" id="modalTransferirPara">
                  <option value="">Selecione um agente...</option>
                </select>
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-12">
              <div class="mb-3">
                <label for="modalObservacoes" class="form-label"><strong>Observações da Atualização:</strong></label>
                <textarea class="form-control" id="modalObservacoes" rows="3" placeholder="Adicione observações sobre as ações realizadas..."></textarea>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <div class="d-flex justify-content-between w-100">
            <div>
              <button type="button" class="btn btn-success" id="modalAtribuir" style="display: none;">
                <i class="fas fa-user-plus"></i> Atribuir a Mim
              </button>
            </div>
            <div>
              <button type="button" class="btn btn-info" id="modalTransferir" style="display: none;">
                <i class="fas fa-exchange-alt"></i> Transferir
              </button>
              <button type="button" class="btn btn-primary" id="modalAtualizar">
                <i class="fas fa-save"></i> Atualizar
              </button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                <i class="fas fa-times"></i> Fechar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Socket.IO -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  
  <!-- Scripts customizados -->
  <script>
    // Navegação entre seções
    function showSection(sectionId) {
      // Esconder todas as seções
      document.querySelectorAll('.section-content').forEach(section => {
        section.style.display = 'none';
      });
      
      // Remover classe active de todos os links
      document.querySelectorAll('.sidebar nav a').forEach(link => {
        link.classList.remove('active');
      });
      
      // Mostrar seção selecionada
      const targetSection = document.getElementById(sectionId);
      if (targetSection) {
        targetSection.style.display = 'block';
      }
      
      // Adicionar classe active ao link correspondente
      const targetLink = document.querySelector(`a[href="#${sectionId}"]`);
      if (targetLink) {
        targetLink.classList.add('active');
      }
      
      // Carregar dados específicos da seção
      if (window.painelAgente) {
        window.painelAgente.carregarDadosSecao(sectionId);
      }
    }
    
    // Event listeners para navegação
    document.addEventListener('DOMContentLoaded', function() {
      // Configurar cliques na sidebar
      document.querySelectorAll('.sidebar nav a[href^="#"]').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const sectionId = this.getAttribute('href').substring(1);
          showSection(sectionId);
        });
      });
      
      // Configurar submenu
      document.querySelectorAll('.submenu-toggle').forEach(toggle => {
        toggle.addEventListener('click', function(e) {
          e.preventDefault();
          const submenu = this.nextElementSibling;
          const isExpanded = this.getAttribute('aria-expanded') === 'true';
          
          this.setAttribute('aria-expanded', !isExpanded);
          submenu.style.display = isExpanded ? 'none' : 'block';
          
          // Rotacionar ícone
          const icon = this.querySelector('i');
          if (icon) {
            icon.style.transform = isExpanded ? 'rotate(0deg)' : 'rotate(90deg)';
          }
        });
      });
      
      // Mostrar dashboard inicialmente
      showSection('dashboard-agente');
    });

    // Painel do Agente de Suporte
    class PainelAgente {
      constructor() {
        this.chamadoAtual = null;
        this.init();
      }

      async init() {
        await this.carregarEstatisticas();
        await this.carregarChamadosDisponiveis();
        await this.carregarMeusChamados();
        this.configurarEventos();
        this.iniciarSocketIO();
      }

      async carregarEstatisticas() {
        try {
          const response = await fetch('/ti/painel/api/agente/estatisticas');
          if (response.ok) {
            const data = await response.json();
            document.getElementById('chamadosAtribuidos').textContent = data.atribuidos || 0;
            document.getElementById('concluidosHoje').textContent = data.concluidos_hoje || 0;
            document.getElementById('chamadosDisponiveis').textContent = data.disponiveis || 0;
            document.getElementById('tempoMedio').textContent = data.tempo_medio || '0h';
          }
        } catch (error) {
          console.error('Erro ao carregar estatísticas:', error);
        }
      }

      async carregarChamadosDisponiveis() {
        try {
          const response = await fetch('/ti/painel/api/chamados/disponiveis');
          if (response.ok) {
            const chamados = await response.json();
            this.renderizarChamadosDisponiveis(chamados);
          }
        } catch (error) {
          console.error('Erro ao carregar chamados disponíveis:', error);
        }
      }

      async carregarMeusChamados(filtro = 'ativos') {
        try {
          const response = await fetch(`/ti/painel/api/agente/meus-chamados?filtro=${filtro}`);
          if (response.ok) {
            const chamados = await response.json();
            this.renderizarMeusChamados(chamados);
          }
        } catch (error) {
          console.error('Erro ao carregar meus chamados:', error);
        }
      }
      
      carregarDadosSecao(sectionId) {
        switch(sectionId) {
          case 'dashboard-agente':
            this.carregarEstatisticas();
            this.carregarChamadosDisponiveis();
            this.carregarMeusChamados();
            break;
          case 'chamados-disponiveis':
            this.carregarChamadosDisponiveisPage();
            break;
          case 'meus-chamados-ativos':
            this.carregarMeusChamadosPage('ativos');
            break;
          case 'meus-chamados-aguardando':
            this.carregarMeusChamadosPage('aguardando');
            break;
          case 'meus-chamados-concluidos':
            this.carregarMeusChamadosPage('concluidos');
            break;
          case 'meus-chamados-cancelados':
            this.carregarMeusChamadosPage('cancelados');
            break;
          case 'historico-agente':
            this.carregarPerfilAgente();
            break;
          case 'estatisticas-agente':
            this.carregarEstatisticasDetalhadas();
            break;
          case 'perfil-agente':
            this.carregarPerfilAgente();
            break;
        }
      }
      
      async carregarChamadosDisponiveisPage() {
        try {
          const response = await fetch('/ti/painel/api/chamados/disponiveis');
          if (response.ok) {
            const chamados = await response.json();
            this.renderizarChamadosDisponiveisPage(chamados);
          }
        } catch (error) {
          console.error('Erro ao carregar chamados disponíveis:', error);
        }
      }
      
      async carregarMeusChamadosPage(filtro) {
        try {
          const response = await fetch(`/ti/painel/api/agente/meus-chamados?filtro=${filtro}`);
          if (response.ok) {
            const chamados = await response.json();
            this.renderizarMeusChamadosPage(chamados, filtro);
          }
        } catch (error) {
          console.error(`Erro ao carregar chamados ${filtro}:`, error);
        }
      }
      
      async carregarEstatisticasDetalhadas() {
        try {
          const response = await fetch('/ti/painel/api/agente/estatisticas-detalhadas');
          if (response.ok) {
            const stats = await response.json();
            this.renderizarEstatisticasDetalhadas(stats);
          }
        } catch (error) {
          console.error('Erro ao carregar estatísticas detalhadas:', error);
        }
      }
      
      async carregarPerfilAgente() {
        try {
          const response = await fetch('/ti/painel/api/agente/perfil');
          if (response.ok) {
            const perfil = await response.json();
            this.preencherPerfilAgente(perfil);
          }
        } catch (error) {
          console.error('Erro ao carregar perfil do agente:', error);
        }
      }

      renderizarChamadosDisponiveis(chamados) {
        const tbody = document.getElementById('tabelaChamadosDisponiveis');
        const count = document.getElementById('countDisponiveis');
        
        count.textContent = chamados.length;
        
        if (chamados.length === 0) {
          tbody.innerHTML = '<tr><td colspan="6" class="text-center">Nenhum chamado disponível</td></tr>';
          return;
        }

        tbody.innerHTML = chamados.map(chamado => `
          <tr>
            <td><span class="badge bg-primary">${chamado.codigo}</span></td>
            <td>${chamado.solicitante}</td>
            <td>${chamado.problema}</td>
            <td><span class="badge bg-${this.getPrioridadeClass(chamado.prioridade)}">${chamado.prioridade}</span></td>
            <td>${chamado.data_abertura}</td>
            <td>
              <button class="btn btn-sm btn-success" onclick="painelAgente.atribuirChamado(${chamado.id})">
                <i class="fas fa-user-plus me-1"></i>Atribuir a Mim
              </button>
              <button class="btn btn-sm btn-outline-info" onclick="painelAgente.verDetalhes(${chamado.id})">
                <i class="fas fa-eye"></i>
              </button>
            </td>
          </tr>
        `).join('');
      }

      renderizarMeusChamados(chamados) {
        const tbody = document.getElementById('tabelaMeusChamados');
        const count = document.getElementById('countMeusChamados');
        
        count.textContent = chamados.length;
        
        if (chamados.length === 0) {
          tbody.innerHTML = '<tr><td colspan="7" class="text-center">Nenhum chamado atribuído</td></tr>';
          return;
        }

        tbody.innerHTML = chamados.map(chamado => `
          <tr>
            <td><span class="badge bg-primary">${chamado.codigo}</span></td>
            <td>${chamado.solicitante}</td>
            <td>${chamado.problema}</td>
            <td><span class="badge bg-${this.getStatusClass(chamado.status)}">${chamado.status}</span></td>
            <td><span class="badge bg-${this.getPrioridadeClass(chamado.prioridade)}">${chamado.prioridade}</span></td>
            <td>${chamado.data_atribuicao}</td>
            <td>
              <button class="btn btn-sm btn-primary" onclick="painelAgente.verDetalhes(${chamado.id})">
                <i class="fas fa-edit me-1"></i>Gerenciar
              </button>
            </td>
          </tr>
        `).join('');
      }

      async atribuirChamado(chamadoId) {
        try {
          const response = await fetch(`/ti/painel/api/chamados/${chamadoId}/atribuir-me`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
          });
          
          if (response.ok) {
            this.showNotification('Chamado atribuído com sucesso!', 'success');
            await this.carregarEstatisticas();
            await this.carregarChamadosDisponiveis();
            await this.carregarMeusChamados();
          } else {
            const error = await response.json();
            this.showNotification(error.error || 'Erro ao atribuir chamado', 'error');
          }
        } catch (error) {
          console.error('Erro ao atribuir chamado:', error);
          this.showNotification('Erro ao atribuir chamado', 'error');
        }
      }

      async verDetalhes(chamadoId) {
        try {
          const response = await fetch(`/ti/painel/api/chamados/${chamadoId}/detalhes`);
          if (response.ok) {
            const chamado = await response.json();
            this.mostrarModalDetalhes(chamado);
          } else {
            this.showNotification('Erro ao carregar detalhes do chamado', 'error');
          }
        } catch (error) {
          console.error('Erro ao carregar detalhes:', error);
          this.showNotification('Erro ao carregar detalhes do chamado', 'error');
        }
      }
      
      mostrarModalDetalhes(chamado) {
        // Preencher dados básicos
        document.getElementById('modalCodigo').textContent = chamado.codigo;
        document.getElementById('modalProtocolo').textContent = chamado.protocolo;
        document.getElementById('modalSolicitante').textContent = chamado.solicitante;
        document.getElementById('modalEmail').textContent = chamado.email;
        document.getElementById('modalTelefone').textContent = chamado.telefone || 'Não informado';
        document.getElementById('modalUnidade').textContent = chamado.unidade;
        document.getElementById('modalProblema').textContent = chamado.problema;
        document.getElementById('modalDescricao').textContent = chamado.descricao || 'Sem descrição';
        document.getElementById('modalDataAbertura').textContent = chamado.data_abertura;
        
        // Prioridade com cor
        const prioridadeBadge = document.getElementById('modalPrioridade');
        prioridadeBadge.textContent = chamado.prioridade;
        prioridadeBadge.className = `badge bg-${this.getPrioridadeClass(chamado.prioridade)}`;
        
        // Status atual
        document.getElementById('modalStatus').value = chamado.status;
        
        // Informações do agente
        const agenteInfo = document.getElementById('modalAgenteInfo');
        const agenteNome = document.getElementById('modalAgente');
        if (chamado.agente) {
          agenteInfo.style.display = 'block';
          agenteNome.textContent = chamado.agente.nome;
        } else {
          agenteInfo.style.display = 'none';
        }
        
        // Botões de ação
        const btnAtribuir = document.getElementById('modalAtribuir');
        const btnTransferir = document.getElementById('modalTransferir');
        const transferSection = document.getElementById('modalTransferSection');
        
        if (!chamado.agente) {
          // Chamado sem agente - mostrar botão atribuir
          btnAtribuir.style.display = 'inline-block';
          btnTransferir.style.display = 'none';
          transferSection.style.display = 'none';
        } else {
          // Chamado com agente - mostrar botão transferir
          btnAtribuir.style.display = 'none';
          btnTransferir.style.display = 'inline-block';
          transferSection.style.display = 'block';
          this.carregarAgentesParaTransferencia(chamado.agente.id);
        }
        
        // Guardar ID do chamado
        this.chamadoAtual = chamado;
        
        // Mostrar modal
        const modal = new bootstrap.Modal(document.getElementById('modalChamado'));
        modal.show();
      }
      
      async carregarAgentesParaTransferencia(agenteAtualId) {
        try {
          const response = await fetch('/ti/painel/api/agentes/ativos');
          if (response.ok) {
            const agentes = await response.json();
            const select = document.getElementById('modalTransferirPara');
            select.innerHTML = '<option value="">Selecione um agente...</option>';
            
            agentes.forEach(agente => {
              if (agente.id !== agenteAtualId) {
                const option = document.createElement('option');
                option.value = agente.id;
                option.textContent = `${agente.nome} (${agente.nivel_experiencia}) - ${agente.chamados_ativos}/${agente.max_chamados}`;
                select.appendChild(option);
              }
            });
          }
        } catch (error) {
          console.error('Erro ao carregar agentes:', error);
        }
      }

      configurarEventos() {
        // Filtros dos meus chamados
        document.querySelectorAll('[data-filter]').forEach(btn => {
          btn.addEventListener('click', (e) => {
            document.querySelectorAll('[data-filter]').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            this.carregarMeusChamados(e.target.getAttribute('data-filter'));
          });
        });

        // Auto-refresh a cada 30 segundos
        setInterval(() => {
          this.carregarEstatisticas();
          this.carregarChamadosDisponiveis();
        }, 30000);
      }

      iniciarSocketIO() {
        const socket = io();
        
        socket.on('novo_chamado', (data) => {
          this.showNotification(`Novo chamado: ${data.codigo}`, 'info');
          this.carregarEstatisticas();
          this.carregarChamadosDisponiveis();
        });

        socket.on('chamado_atualizado', (data) => {
          this.carregarEstatisticas();
          this.carregarMeusChamados();
        });

        socket.on('chamado_atribuido', (data) => {
          // Se o chamado foi atribuído ao agente atual, mostrar notificação e atualizar
          if (data.agente_email === '{{ current_user.email }}') {
            this.showNotification(`Novo chamado atribuído: ${data.codigo}`, 'success');
            this.carregarEstatisticas();
            this.carregarChamadosDisponiveis();
            this.carregarMeusChamados();
            // Atualizar também a seção ativa se for uma das páginas de chamados
            const activeSection = document.querySelector('.sidebar nav a.active');
            if (activeSection) {
              const sectionId = activeSection.getAttribute('href').substring(1);
              this.carregarDadosSecao(sectionId);
            }
          } else {
            // Apenas atualizar chamados disponíveis se foi atribuído a outro agente
            this.carregarChamadosDisponiveis();
            this.carregarEstatisticas();
          }
        });

        socket.on('chamado_transferido', (data) => {
          // Se o chamado foi transferido para o agente atual
          if (data.agente_destino_email === '{{ current_user.email }}') {
            this.showNotification(`Chamado transferido para você: ${data.codigo}`, 'info');
            this.carregarEstatisticas();
            this.carregarMeusChamados();
            // Atualizar seção ativa
            const activeSection = document.querySelector('.sidebar nav a.active');
            if (activeSection) {
              const sectionId = activeSection.getAttribute('href').substring(1);
              this.carregarDadosSecao(sectionId);
            }
          }
          // Se o chamado foi transferido do agente atual para outro
          else if (data.agente_origem_email === '{{ current_user.email }}') {
            this.showNotification(`Chamado ${data.codigo} foi transferido para ${data.agente_destino_nome}`, 'info');
            this.carregarEstatisticas();
            this.carregarMeusChamados();
            // Atualizar seção ativa
            const activeSection = document.querySelector('.sidebar nav a.active');
            if (activeSection) {
              const sectionId = activeSection.getAttribute('href').substring(1);
              this.carregarDadosSecao(sectionId);
            }
          }
        });
      }

      getPrioridadeClass(prioridade) {
        const classes = {
          'Crítica': 'danger',
          'Alta': 'warning',
          'Normal': 'info',
          'Baixa': 'secondary'
        };
        return classes[prioridade] || 'secondary';
      }

      getStatusClass(status) {
        const classes = {
          'Aberto': 'primary',
          'Aguardando': 'warning',
          'Concluido': 'success',
          'Cancelado': 'danger'
        };
        return classes[status] || 'secondary';
      }

      showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show`;
        notification.innerHTML = `
          ${message}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        const container = document.getElementById('notificationContainer');
        container.appendChild(notification);
        
        setTimeout(() => {
          notification.remove();
        }, 5000);
      }
      
      renderizarChamadosDisponiveisPage(chamados) {
        const tbody = document.getElementById('tabelaChamadosDisponiveisPage');
        const count = document.getElementById('countDisponiveisPage');
        
        count.textContent = chamados.length;
        
        if (chamados.length === 0) {
          tbody.innerHTML = '<tr><td colspan="8" class="text-center">Nenhum chamado disponível</td></tr>';
          return;
        }

        tbody.innerHTML = chamados.map(chamado => `
          <tr>
            <td><span class="badge bg-primary">${chamado.codigo}</span></td>
            <td><span class="badge bg-secondary">${chamado.protocolo}</span></td>
            <td>${chamado.solicitante}</td>
            <td>${chamado.problema}</td>
            <td><span class="badge bg-${this.getPrioridadeClass(chamado.prioridade)}">${chamado.prioridade}</span></td>
            <td>${chamado.data_abertura}</td>
            <td>
              <div class="text-truncate" style="max-width: 200px;" title="${chamado.descricao || 'Sem descrição'}">
                ${chamado.descricao || 'Sem descrição'}
              </div>
            </td>
            <td>
              <button class="btn btn-sm btn-success me-1" onclick="painelAgente.atribuirChamado(${chamado.id})" title="Atribuir a mim">
                <i class="fas fa-user-plus"></i>
              </button>
              <button class="btn btn-sm btn-outline-info" onclick="painelAgente.verDetalhes(${chamado.id})" title="Ver detalhes">
                <i class="fas fa-eye"></i>
              </button>
            </td>
          </tr>
        `).join('');
      }
      
      renderizarMeusChamadosPage(chamados, filtro) {
        let tbody, count;
        
        switch(filtro) {
          case 'ativos':
            tbody = document.getElementById('tabelaMeusChamadosAtivosPage');
            count = document.getElementById('countAtivosPage');
            break;
          case 'aguardando':
            tbody = document.getElementById('tabelaMeusChamadosAguardandoPage');
            count = document.getElementById('countAguardandoPage');
            break;
          case 'concluidos':
            tbody = document.getElementById('tabelaMeusChamadosConcluidosPage');
            count = document.getElementById('countConcluidosPage');
            break;
          case 'cancelados':
            tbody = document.getElementById('tabelaMeusChamadosCanceladosPage');
            count = document.getElementById('countCanceladosPage');
            break;
        }
        
        if (!tbody || !count) return;
        
        count.textContent = chamados.length;
        
        if (chamados.length === 0) {
          tbody.innerHTML = '<tr><td colspan="8" class="text-center">Nenhum chamado encontrado</td></tr>';
          return;
        }

        tbody.innerHTML = chamados.map(chamado => `
          <tr>
            <td><span class="badge bg-primary">${chamado.codigo}</span></td>
            <td><span class="badge bg-secondary">${chamado.protocolo || 'N/A'}</span></td>
            <td>${chamado.solicitante}</td>
            <td>${chamado.problema}</td>
            <td><span class="badge bg-${this.getStatusClass(chamado.status)}">${chamado.status}</span></td>
            <td><span class="badge bg-${this.getPrioridadeClass(chamado.prioridade)}">${chamado.prioridade}</span></td>
            <td>${chamado.data_atribuicao || chamado.data_conclusao || 'N/A'}</td>
            <td>
              <button class="btn btn-sm btn-primary me-1" onclick="painelAgente.verDetalhes(${chamado.id})" title="Gerenciar">
                <i class="fas fa-edit"></i>
              </button>
            </td>
          </tr>
        `).join('');
      }
      
      renderizarEstatisticasDetalhadas(stats) {
        document.getElementById('estatTotalAtendidos').textContent = stats.total_atendidos || 0;
        document.getElementById('estatTempoMedio').textContent = stats.tempo_medio || '0h';
        document.getElementById('estatAtendimentosHoje').textContent = stats.atendimentos_hoje || 0;
        document.getElementById('estatAvaliacaoMedia').textContent = stats.avaliacao_media || '5.0';
      }
      
      preencherPerfilAgente(perfil) {
        document.getElementById('perfilNome').value = perfil.nome || '';
        document.getElementById('perfilEmail').value = perfil.email || '';
        document.getElementById('perfilTelefone').value = perfil.telefone || '';
        document.getElementById('perfilEspecialidades').value = perfil.especialidades || '';
        document.getElementById('perfilNivelExperiencia').value = perfil.nivel_experiencia || 'junior';
        document.getElementById('perfilMaxChamados').value = perfil.max_chamados || 10;
        document.getElementById('perfilNotificacoes').checked = perfil.notificacoes || false;
        document.getElementById('perfilAutoAtribuicao').checked = perfil.auto_atribuicao || false;
      }
      
      async atualizarChamado() {
        if (!this.chamadoAtual) return;
        
        const novoStatus = document.getElementById('modalStatus').value;
        const observacoes = document.getElementById('modalObservacoes').value;
        
        try {
          const response = await fetch(`/ti/painel/api/chamados/${this.chamadoAtual.id}/atualizar`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              status: novoStatus,
              observacoes: observacoes
            })
          });
          
          if (response.ok) {
            this.showNotification('Chamado atualizado com sucesso!', 'success');
            bootstrap.Modal.getInstance(document.getElementById('modalChamado')).hide();
            // Recarregar dados
            this.carregarEstatisticas();
            this.carregarDadosSecao(document.querySelector('.sidebar nav a.active').getAttribute('href').substring(1));
          } else {
            const error = await response.json();
            this.showNotification(error.error || 'Erro ao atualizar chamado', 'error');
          }
        } catch (error) {
          console.error('Erro ao atualizar chamado:', error);
          this.showNotification('Erro ao atualizar chamado', 'error');
        }
      }
      
      async transferirChamado() {
        if (!this.chamadoAtual) return;
        
        const agenteDestinoId = document.getElementById('modalTransferirPara').value;
        const observacoes = document.getElementById('modalObservacoes').value;
        
        if (!agenteDestinoId) {
          this.showNotification('Selecione um agente para transferência', 'warning');
          return;
        }
        
        try {
          const response = await fetch(`/ti/painel/api/chamados/${this.chamadoAtual.id}/transferir`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              agente_destino_id: agenteDestinoId,
              observacoes: observacoes
            })
          });
          
          if (response.ok) {
            this.showNotification('Chamado transferido com sucesso!', 'success');
            bootstrap.Modal.getInstance(document.getElementById('modalChamado')).hide();
            // Recarregar dados
            this.carregarEstatisticas();
            this.carregarDadosSecao(document.querySelector('.sidebar nav a.active').getAttribute('href').substring(1));
          } else {
            const error = await response.json();
            this.showNotification(error.error || 'Erro ao transferir chamado', 'error');
          }
        } catch (error) {
          console.error('Erro ao transferir chamado:', error);
          this.showNotification('Erro ao transferir chamado', 'error');
        }
      }
    }

    // Inicializar quando o DOM estiver carregado
    document.addEventListener('DOMContentLoaded', () => {
      window.painelAgente = new PainelAgente();
      
      // Event listeners para modal
      document.getElementById('modalAtribuir')?.addEventListener('click', () => {
        if (window.painelAgente.chamadoAtual) {
          window.painelAgente.atribuirChamado(window.painelAgente.chamadoAtual.id);
        }
      });
      
      document.getElementById('modalAtualizar')?.addEventListener('click', () => {
        window.painelAgente.atualizarChamado();
      });
      
      document.getElementById('modalTransferir')?.addEventListener('click', () => {
        window.painelAgente.transferirChamado();
      });
      
      // Event listener para toggle de transferência
      document.getElementById('modalTransferir')?.addEventListener('click', () => {
        const transferSection = document.getElementById('modalTransferSection');
        const isVisible = transferSection.style.display !== 'none';
        transferSection.style.display = isVisible ? 'none' : 'block';
      });
    });
  </script>
</body>
</html>
